<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <title>Product Manager</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</head>

<body class="container mt-4">
    <h1 class="mb-4">Product List</h1>

    <table class="table table-bordered">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Price</th>
                <th>Quantity</th>
                <th>Action</th>
            </tr>
        </thead>
        <tbody>
            {% for product in products %}
            <tr>
                <td>{{ product.id }}</td>
                <td>{{ product.name }}</td>
                <td>{{ product.price }}</td>
                <td>{{ product.quantity }}</td>
                <td>
                    <button class="btn btn-sm btn-info" onclick="openEdit({{ product.id }})">Edit</button>
                    <button class="btn btn-sm btn-danger" onclick="deleteProduct({{ product.id }})">Delete</button>
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <h2 class="mt-5">Add Product</h2>
    <form id="addForm" class="row g-3 mt-2">
        <div class="col-md-4">
            <input type="text" name="name" class="form-control" placeholder="Name" required minlength="5">
        </div>
        <div class="col-md-3">
            <input type="number" name="price" class="form-control" placeholder="Price" step="0.01" required>
        </div>
        <div class="col-md-3">
            <input type="number" name="quantity" class="form-control" placeholder="Quantity" min="0" required>
        </div>
        <div class="col-md-2">
            <button type="submit" class="btn btn-primary w-100">Add</button>
        </div>
    </form>

    <!-- Edit Modal -->
    <div class="modal fade" id="editModal" tabindex="-1" aria-hidden="true">
        <div class="modal-dialog">
            <form id="editForm" class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Edit Product</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <input type="hidden" id="edit-id">
                    <div class="mb-3">
                        <label>Name</label>
                        <input type="text" id="edit-name" class="form-control" required minlength="5">
                    </div>
                    <div class="mb-3">
                        <label>Price</label>
                        <input type="number" id="edit-price" class="form-control" required step="0.01">
                    </div>
                    <div class="mb-3">
                        <label>Quantity</label>
                        <input type="number" id="edit-quantity" class="form-control" required min="0">
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="submit" class="btn btn-primary">Save</button>
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        const API_URL = "http://localhost:8000/products";

        // Add product
        document.getElementById("addForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const form = e.target;
            const payload = {
                name: form.name.value,
                price: parseFloat(form.price.value),
                quantity: parseInt(form.quantity.value)
            };
            fetch(API_URL, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            }).then(res => {
                if (res.ok) location.reload();
                else alert("Failed to add product");
            });
        });

        // Delete product
        function deleteProduct(id) {
            if (confirm("Are you sure you want to delete this product?")) {
                fetch(`${API_URL}/${id}`, {
                    method: "DELETE"
                }).then(res => {
                    if (res.ok) location.reload();
                    else alert("Delete failed");
                });
            }
        }

        // Open edit modal
        function openEdit(id) {
            fetch(`${API_URL}/${id}`)
                .then(res => res.json())
                .then(data => {
                    document.getElementById("edit-id").value = data.id;
                    document.getElementById("edit-name").value = data.name;
                    document.getElementById("edit-price").value = data.price;
                    document.getElementById("edit-quantity").value = data.quantity;
                    new bootstrap.Modal(document.getElementById("editModal")).show();
                });
        }

        // Submit edit
        document.getElementById("editForm").addEventListener("submit", function (e) {
            e.preventDefault();
            const id = document.getElementById("edit-id").value;
            const payload = {
                name: document.getElementById("edit-name").value,
                price: parseFloat(document.getElementById("edit-price").value),
                quantity: parseInt(document.getElementById("edit-quantity").value)
            };
            fetch(`${API_URL}/${id}`, {
                method: "PUT",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            }).then(res => {
                if (res.ok) location.reload();
                else alert("Update failed");
            });
        });
    </script>
</body>

</html>